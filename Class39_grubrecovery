Class 39 08/09/2025

Grub recovery in RHEL

Occurences:
===========
1) Whenever need server access (CHG's are INC's) +300 days
2) After patching reboot
3) Unexpected reboot/hung

RHEL7 grub menu: Whenever the grub.cfg file missing we can see grub menu
========================================================================
Step1: recycle the server and see the console output
Step2: rescue boot CDROM/NetworkBoot
Step3: after rescue boot mount harddisk in "/mnt/sysimage"
Step4: switch to root image from rescue image with below command
	# chroot /mnt/sysimage
Step5: validate the grub.cfg file and regenarate with below command
	# mv /boot/grub2/grub.cfg /tmp/   =====> If the file exist
	# grub2-mkconfig -o /boot/grub2/grub.cfg ===> by reading /etc/default/grub
Step6: boot the server with harddisk image
Step7: Login the server and validate the checkouts

RHEL7 grub rescue menu: Whenever the grub2 directory corrupted we can see grub rescue menu
==========================================================================================
Step1: recycle the server and see the console output
Step2: rescue boot CDROM/NetworkBoot
Step3: after rescue boot mount harddisk in "/mnt/sysimage"
Step4: switch to root image from rescue image with below command
	# chroot /mnt/sysimage
Step5: Identify the boot device with below command
	# parted -l |more
Step6: Regenerate grub2 directory with belowcommand
	# grub2-install /dev/sda   ====> boot device is sda
	# grub2-mkconfig -o /boot/grub2/grub.cfg
	# ls -l /boot/grub2  ===> make sure the grub.cfg file is generated
	# exit from the OS harddisk image
Step7: boot the server with harddisk image
Step8: Login the server and validate the checkouts


RHEL6 grub menu: Whenever the grub.cfg file missing we can see grub menu
========================================================================
Step1: recycle the server and see the console output
Step2: rescue boot CDROM/NetworkBoot
Step3: after rescue boot mount harddisk in "/mnt/sysimage"
Step4: switch to root image from rescue image with below command
	# chroot /mnt/sysimage
Step5: validate the grub.conf file and regenarate with below commands
	# mv /boot/grub/grub.conf /tmp/   =====> If the file exist
	# vi /boot/grub/grub.conf  =====> create a new file and add below entries
	default=0
	timeout=5
	splashimage=(hd0,0)/grub/splash.xpm.gz
	hiddenmenu
	title Red Hat Enterprise Linux (2.6.32-431.el6.x86_64)
        	root (hd0,0)
        	kernel /vmlinuz-2.6.32-431.el6.x86_64 ro root=/dev/mapper/vg_ns14606-lv_root
			initrd /initramfs-2.6.32-431.el6.x86_64.img
	# ln -s /boot/grub/grub.conf /boot/grub/menu.lst
	# exit
Step6: boot the server with harddisk image
Step7: Login the server and validate the checkouts

RHEL6 Error15 menu: Whenever the grub2 directory corrupted we can see grub rescue menu
==========================================================================================
Step1: recycle the server and see the console output
Step2: rescue boot CDROM/NetworkBoot
Step3: after rescue boot mount harddisk in "/mnt/sysimage"
Step4: switch to root image from rescue image with below command
	# chroot /mnt/sysimage
Step5: Identify the boot device with below command
	# fdisk -l |more
Step6: Regenerate grub2 directory with belowcommand
	# grub-install /dev/sda   ====> boot device is sda
Step7: validate the grub.conf file and regenarate with below commands
	# vi /boot/grub/grub.conf  =====> create a new file and add below entries
	default=0
	timeout=5
	splashimage=(hd0,0)/grub/splash.xpm.gz
	hiddenmenu
	title Red Hat Enterprise Linux (2.6.32-431.el6.x86_64)
        	root (hd0,0)
        	kernel /vmlinuz-2.6.32-431.el6.x86_64 ro root=/dev/mapper/vg_ns14606-lv_root
	# ln -s /boot/grub/grub.conf /boot/grub/menu.lst
	# exit
Step8: boot the server with harddisk image
Step9: Login the server and validate the checkouts
